<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/main.xhtml">
    <!--PrimeFaces is a UI components library over the JSF framework (7 JavaServer Faces Technology).
    It has things like date pickers, data grids, graphics, carousels, etc.
    So many of the configurations and the coding has actually more to do with JSF -->


    <!--Explanation of sequence of Events in frontend:
    Here's a simplified sequence of events:

    1. User clicks the "CommitSearchRequest" button.
    2. The performLocationSearch method is invoked, updating the latitude and longitude values in WeatherApiDemoBean.
    3. The performWeatherApiRequest method is called directly within the commandButton action, and it can access the updated latitude and longitude values from WeatherApiDemoBean.
    4. Both methods execute within the same request-response cycle, so the bean state is available and consistent throughout.

    Since the view scope keeps the bean alive for the duration of the user's interaction with a specific view,
    both methods (performLocationSearch and performWeatherApiRequest) will operate on the same instance of the bean
    during the same view lifecycle.
    Therefore, any changes made in one method will be reflected in the other within the same view scope.
    -->
    <ui:define name="content">
        <h:form id="weatherForm">
            <p:panel header="Location Search">
                <p:autoComplete id="locationSearch" value="#{weatherApiDemoBean.locationSearchInput}"
                                completeMethod="#{autoCompleteController.autoCompleteLocation}"
                                style="margin-right: 10px;" emptyMessage="no results"/>


                <p:commandButton value="Search" id="commitSearchRequest"
                                 action="#{weatherApiDemoBean.performLocationSearch()}"
                                 update="weatherForm">
                </p:commandButton>
                <br/>
                <p:messages id="message" showDetail="true"/>
            </p:panel>

            <p:panel header="Request" id="Request">
                <div style="height: 50px">

                    resulting api call to weatherApi:
                    https://api.openweathermap.org/data/3.0/onecall?lat=#{weatherApiDemoBean.location.id.latitude}&amp;lon=#{weatherApiDemoBean.location.id.longitude}&amp;appid=passwort
                </div>
            </p:panel>
            <br/>
            <p:panel header="Response" id="Response" rendered="#{weatherApiDemoBean.isLocationAnswerDTOReady}">
                <div>
                    <h4>Location searched for:
                        #{weatherApiDemoBean.location.city},
                        #{weatherApiDemoBean.location.country}
                        <!-- check wether this gets rendered even when state is null-->
                        <h:outputText value=",#{weatherApiDemoBean.location.state}"
                                      rendered="#{not empty weatherApiDemoBean.location.state}"/>
                    </h4>
                    <br/>
                    <h5 style="margin-top:0">Current Weather</h5>
                    <h:panelGrid columns="2">
                        <h:outputText value="Weather Description"/>
                        <h:outputText
                                value="#{weatherApiDemoBean.weatherDTO.currentWeather().weather().description()}"/>
                        <h:outputText value="Temperature"/>
                        <h:outputText
                                value="#{weatherApiDemoBean.weatherDTO.currentWeather().temperature()}"/>
                        <h:outputText value="Sunset"/>
                        <h:outputText
                                value="#{weatherApiDemoBean.sunsetString}"/>
                    </h:panelGrid>
                </div>
                <p:commandButton id="toggleFavorite"
                                 action="#{weatherApiDemoBean.toggleFavorite()}"
                                 rendered="#{weatherApiDemoBean.searchedWeather != null}" icon="pi pi-heart"
                                 styleClass="#{weatherApiDemoBean.isFavorite() ? 'rounded-button ui-button-help' : 'rounded-button ui-button-help ui-button-outlined'}"
                                 update="toggleFavorite"/>
            </p:panel>
        </h:form>
    </ui:define>

</ui:composition>